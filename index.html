<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Hiragana Typing</title>
    <style>
        :root { --p: #ff69b4; --bg: #fff0f5; --txt: #5d4037; }
        body { font-family: sans-serif; background: var(--bg); color: var(--txt); display: flex; flex-direction: column; height: 100vh; margin: 0; overflow: hidden; }
        .card { background: white; flex: 1; margin: 5px; border-radius: 15px; padding: 8px; border: 2px solid #ffb6c1; display: flex; flex-direction: column; min-height: 0; }
        .btns { display: flex; flex-wrap: wrap; gap: 5px; padding-bottom: 5px; }
        .small-btn { font-size: 10px; padding: 4px 8px; cursor: pointer; font-weight: bold; }
        .selector { background: #fffafa; border-radius: 10px; padding: 8px; border: 1px solid #ffb6c1; margin-bottom: 8px; }
        .group-title { font-size: 10px; color: var(--p); font-weight: bold; border-left: 3px solid var(--p); padding-left: 5px; display: block; margin: 4px 0; }
        .chips { display: flex; flex-wrap: wrap; gap: 4px; }
        .chip { display: flex; align-items: center; background: white; border: 1px solid #ffb6c1; padding: 2px 8px; border-radius: 20px; font-size: 12px; cursor: pointer; }
        .chip:has(input:checked) { background: var(--p); color: white; }
        .display { flex: 1; overflow-y: auto; background: #fafafa; border-radius: 10px; display: flex; flex-direction: column; align-items: center; padding: 10px 0; }
        table { border-collapse: separate; border-spacing: 2px; }
        td { border: 1px solid #ffdae0; width: 40px; height: 40px; text-align: center; border-radius: 6px; background: #fff; position: relative; }
        .v-label { background: var(--bg); color: #ff1493; font-size: 10px; font-weight: bold; width: 20px; border: none; }
        .kana { font-size: 16px; font-weight: bold; display: block; }
        .romaji { font-size: 8px; color: var(--p); display: block; }
        .target { border: 3px solid #ff1493 !important; background: #fff0f5 !important; }
        .quiz { height: 130px; border-top: 2px solid var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #q { font-size: 50px; color: var(--p); font-weight: bold; margin: 0; }
        #ans { font-size: 20px; width: 140px; text-align: center; border: 2px solid #ffb6c1; border-radius: 20px; outline: none; }
        .action { padding: 8px 25px; font-size: 16px; font-weight: bold; background: var(--p); color: white; border: none; border-radius: 15px; cursor: pointer; margin-top: 5px; }
        #fb { font-size: 12px; font-weight: bold; height: 15px; margin-bottom: 2px; }
    </style>
</head>
<body>
<div class="card">
    <div class="btns">
        <button class="small-btn" onclick="sel(true)">All ON</button>
        <button class="small-btn" onclick="sel(false)">All OFF</button>
        <button class="small-btn" onclick="only('basic')">Step 1 Only</button>
        <button class="small-btn" onclick="only('contracted')">Step 2 Only</button>
        <button class="small-btn" onclick="only('foreign')">Step 3 Only</button>
    </div>
    <div class="selector">
        <span class="group-title">STEP 1: BASIC</span><div id="c-basic" class="chips"></div>
        <span class="group-title">STEP 2: COMBINED</span><div id="c-contracted" class="chips"></div>
        <span class="group-title">STEP 3: SPECIAL</span><div id="c-foreign" class="chips"></div>
    </div>
    <div class="display"><div id="chart"></div></div>
    <div class="quiz">
        <div id="fb"></div><div id="q">?</div>
        <input type="text" id="ans" placeholder="Type..." autocomplete="off">
        <div>
            <button id="ok" class="action" onclick="check()">OK</button>
            <button id="next" class="action" onclick="nextQ()" style="display:none; background:#4caf50;">NEXT</button>
        </div>
    </div>
</div>
<script>
const gameData = {
    basic: [
        { label: "ã‚", data: [[0,0,"ã‚","a"],[0,1,"ã„","i"],[0,2,"ã†","u"],[0,3,"ãˆ","e"],[0,4,"ãŠ","o"]] },
        { label: "ã‹", data: [[1,0,"ã‹","ka"],[1,1,"ã","ki"],[1,2,"ã","ku"],[1,3,"ã‘","ke"],[1,4,"ã“","ko"]] },
        { label: "ã•", data: [[2,0,"ã•","sa"],[2,1,"ã—","shi"],[2,2,"ã™","su"],[2,3,"ã›","se"],[2,4,"ã","so"]] },
        { label: "ãŸ", data: [[3,0,"ãŸ","ta"],[3,1,"ã¡","chi"],[3,2,"ã¤","tsu"],[3,3,"ã¦","te"],[3,4,"ã¨","to"]] },
        { label: "ãª", data: [[4,0,"ãª","na"],[4,1,"ã«","ni"],[4,2,"ã¬","nu"],[4,3,"ã­","ne"],[4,4,"ã®","no"]] },
        { label: "ã¯", data: [[5,0,"ã¯","ha"],[5,1,"ã²","hi"],[5,2,"ãµ","fu"],[5,3,"ã¸","he"],[5,4,"ã»","ho"]] },
        { label: "ã¾", data: [[6,0,"ã¾","ma"],[6,1,"ã¿","mi"],[6,2,"ã‚€","mu"],[6,3,"ã‚","me"],[6,4,"ã‚‚","mo"]] },
        { label: "ã‚„", data: [[7,0,"ã‚„","ya"],[7,2,"ã‚†","yu"],[7,4,"ã‚ˆ","yo"]] },
        { label: "ã‚‰", data: [[8,0,"ã‚‰","ra"],[8,1,"ã‚Š","ri"],[8,2,"ã‚‹","ru"],[8,3,"ã‚Œ","re"],[8,4,"ã‚","ro"]] },
        { label: "ã‚", data: [[9,0,"ã‚","wa"],[9,2,"ã‚’","wo"],[9,4,"ã‚“","nn"]] },
        { label: "ãŒ", data: [[11,0,"ãŒ","ga"],[11,1,"ãŽ","gi"],[11,2,"ã","gu"],[11,3,"ã’","ge"],[11,4,"ã”","go"]] },
        { label: "ã–", data: [[12,0,"ã–","za"],[12,1,"ã˜","ji"],[12,2,"ãš","zu"],[12,3,"ãœ","ze"],[12,4,"ãž","zo"]] },
        { label: "ã ", data: [[13,0,"ã ","da"],[13,1,"ã¢","ji"],[13,2,"ã¥","zu"],[13,3,"ã§","de"],[13,4,"ã©","do"]] },
        { label: "ã°", data: [[14,0,"ã°","ba"],[14,1,"ã³","bi"],[14,2,"ã¶","bu"],[14,3,"ã¹","be"],[14,4,"ã¼","bo"]] },
        { label: "ã±", data: [[15,0,"ã±","pa"],[15,1,"ã´","pi"],[15,2,"ã·","pu"],[15,3,"ãº","pe"],[15,4,"ã½","po"]] }
    ],
    contracted: [
        { label: "ãã‚ƒ", data: [[0,0,"ãã‚ƒ","kya"],[0,2,"ãã‚…","kyu"],[0,4,"ãã‚‡","kyo"]] },
        { label: "ã—ã‚ƒ", data: [[1,0,"ã—ã‚ƒ","sha"],[1,2,"ã—ã‚…","shu"],[1,4,"ã—ã‚‡","sho"]] },
        { label: "ã¡ã‚ƒ", data: [[2,0,"ã¡ã‚ƒ","cha"],[2,2,"ã¡ã‚…","chu"],[2,4,"ã¡ã‚‡","cho"]] },
        { label: "ã«ã‚ƒ", data: [[3,0,"ã«ã‚ƒ","nya"],[3,2,"ã«ã‚…","nyu"],[3,4,"ã«ã‚‡","nyo"]] },
        { label: "ã²ã‚ƒ", data: [[4,0,"ã²ã‚ƒ","hya"],[4,2,"ã²ã‚…","hyu"],[4,4,"ã²ã‚‡","hyo"]] },
        { label: "ã¿ã‚ƒ", data: [[5,0,"ã¿ã‚ƒ","mya"],[5,2,"ã¿ã‚…","myu"],[5,4,"ã¿ã‚‡","myo"]] },
        { label: "ã‚Šã‚ƒ", data: [[6,0,"ã‚Šã‚ƒ","rya"],[6,2,"ã‚Šã‚…","ryu"],[6,4,"ã‚Šã‚‡","ryo"]] },
        { label: "ãŽã‚ƒ", data: [[8,0,"ãŽã‚ƒ","gya"],[8,2,"ãŽã‚…","gyu"],[8,4,"ãŽã‚‡","gyo"]] },
        { label: "ã˜ã‚ƒ", data: [[9,0,"ã˜ã‚ƒ","ja"],[9,2,"ã˜ã‚…","ju"],[9,4,"ã˜ã‚‡","jo"]] },
        { label: "ã³ã‚ƒ", data: [[10,0,"ã³ã‚ƒ","bya"],[10,2,"ã³ã‚…","byu"],[10,4,"ã³ã‚‡","byo"]] },
        { label: "ã´ã‚ƒ", data: [[11,0,"ã´ã‚ƒ","pya"],[11,2,"ã´ã‚…","pyu"],[11,4,"ã´ã‚‡","pyo"]] }
    ],
    foreign: [
        { label: "ãµã", data: [[0,0,"ãµã","fa"],[0,1,"ãµãƒ","fi"],[0,3,"ãµã‡","fe"],[0,4,"ãµã‰","fo"]] },
        { label: "ã¦ãƒ", data: [[1,1,"ã¦ãƒ","thi"]] },
        { label: "ã¡ã‡", data: [[2,3,"ã¡ã‡","che"]] },
        { label: "ã§ãƒ", data: [[3,1,"ã§ãƒ","dhi"],[3,2,"ã§ã‚…","dhu"]] },
        { label: "ã˜ã‡", data: [[5,3,"ã˜ã‡","je"],[6,3,"ã—ã‡","she"]] },
        { label: "ã‚”ã", data: [[8,0,"ã‚”ã","va"],[8,1,"ã‚”ãƒ","vi"],[8,2,"ã‚”","vu"],[8,3,"ã‚”ã‡","ve"],[8,4,"ã‚”ã‰","vo"]] },
        { label: "ã†ãƒ", data: [[9,1,"ã†ãƒ","wi"],[9,3,"ã†ã‡","we"],[9,4,"ã†ã‰","who"]] }
    ]
};
let cur = null;
function init() {
    for (const k in gameData) {
        const div = document.getElementById('c-'+k);
        gameData[k].forEach((g, i) => {
            const l = document.createElement('label'); l.className = 'chip';
            const chk = (k==='basic'&&i===0)?'checked':'';
            l.innerHTML = `<input type="checkbox" data-cat="${k}" data-idx="${i}" ${chk} onchange="upd()"> ${g.label}`;
            div.appendChild(l);
        });
    }
    upd();
}
function sel(v) { document.querySelectorAll('.chip input').forEach(i=>i.checked=v); upd(); }
function only(cat) { document.querySelectorAll('.chip input').forEach(i=>i.checked=(i.dataset.cat===cat)); upd(); }
function upd() {
    const cont = document.getElementById('chart'); cont.innerHTML = "";
    const selected = Array.from(document.querySelectorAll('.chip input:checked')).map(i=>({cat:i.dataset.cat, d:gameData[i.dataset.cat][i.dataset.idx].d}));
    if(!selected.length) { document.getElementById('q').innerText="?"; return; }
    [...new Set(selected.map(s=>s.cat))].forEach(c=>{
        const list = selected.filter(s=>s.cat===c).flatMap(s=>s.d);
        const maxC = Math.max(...list.map(d=>d[0])), minC = Math.min(...list.map(d=>d[0]));
        const lbs = (c==='contracted')?["ya","","yu","","yo"]:["a","i","u","e","o"];
        let h = `<table>`;
        for(let r=0; r<5; r++){
            h+=`<tr><td class="v-label">${lbs[r]}</td>`;
            for(let col=minC; col<=maxC; col++){
                const item = list.find(d=>d[0]===col && d[1]===r);
                h += item ? `<td id="cell-${c}-${col}-${r}"><span class="kana">${item[2]}</span><span class="romaji">${item[3]}</span></td>` : `<td style="border:none;background:none;"></td>`;
            }
            h+='</tr>';
        }
        cont.innerHTML += h+'</table>';
    });
    nextQ();
}
function nextQ() {
    const sel = Array.from(document.querySelectorAll('.chip input:checked'));
    if(!sel.length) return;
    const rG = sel[Math.floor(Math.random()*sel.length)];
    const rI = gameData[rG.dataset.cat][rG.dataset.idx].data;
    cur = {cat:rG.dataset.cat, d: rI[Math.floor(Math.random()*rI.length)]};
    document.getElementById('q').innerText = cur.d[2];
    const i = document.getElementById('ans'); i.value=''; i.disabled=false; i.focus();
    document.getElementById('fb').innerText=''; document.getElementById('next').style.display='none'; document.getElementById('ok').style.display='inline-block';
    document.querySelectorAll('td').forEach(t=>t.classList.remove('target'));
}
function check() {
    const v = document.getElementById('ans').value.toLowerCase().trim();
    const isC = (v===cur.d[3]) || (cur.d[2]==='ã—'&&v==='si') || (cur.d[2]==='ã¡'&&v==='ti') || (cur.d[2]==='ã¤'&&v==='tu') || (cur.d[2]==='ãµ'&&v==='hu') || (cur.d[2]==='ã˜'&&(v==='zi'||v==='ji')) || (cur.d[2]==='ã‚’'&&v==='o');
    const td = document.getElementById(`cell-${cur.cat}-${cur.d[0]}-${cur.d[1]}`);
    if(isC) {
        document.getElementById('fb').innerText='Correct! âœ¨'; document.getElementById('ans').disabled=true;
        document.getElementById('ok').style.display='none'; document.getElementById('next').style.display='inline-block'; document.getElementById('next').focus();
        if(td) { td.classList.add('target'); td.scrollIntoView({behavior:'smooth',block:'center'}); }
    } else {
        document.getElementById('fb').innerText='Check chart! ðŸ’¡';
        if(td) { td.classList.add('target'); td.scrollIntoView({behavior:'smooth',block:'center'}); }
    }
}
document.getElementById('ans').onkeydown=(e)=>{ if(e.key==='Enter') (document.getElementById('next').style.display==='none')?check():nextQ(); };
init();
</script>
</body>
</html>
